{"version":3,"sources":["pages/basket_page.js"],"names":["$","setQuantity","each","ind","elem","updateFormDebounce","_utils","debounce","$quantityWrapper","find","$incr","$quantityfield","attr","$decr","val","on","number","this","$basketContent","addClass","removeClass","max","min","split","parseFloat","toFixed","currentVal","e","preventDefault","disallowToChange","bindCoupon","$form","$confirmBtn","formValid","requiredError","_radonOptions","invalidEmailError","hide","show","click","onsubmit","prop","blur","validateForm","submit","window","basketURL","basketUrl","disallowToUpdate","updateBasket","ajax","data","type","html","content_html","url","messages","serialize","i","level","length","renderMessages","error","formID","inputID","closest","jQuery"],"mappings":"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","file":"basket_page.js","sourcesContent":["(($) => {\n    'use strict';\n\n    let basketUrl = window._radonOptions.basketURL;\n    let $messagesWrapper = $('#messages');\n    let $basketContent = $('.basket-page-content');\n\n    let disallowToChange = false;\n    let disallowToUpdate = false;\n\n    let updateBasket = () => {\n        if(disallowToUpdate) { return; }\n        disallowToChange = true;\n        $basketContent.find('.dimmer').show();\n        let $form = $basketContent.find('form');\n        $basketContent.find('#procced-basket').addClass('disabled');\n        $.ajax({\n            type: 'POST',\n            url: $form.attr('action'),\n            data: $form.serialize(),\n            success: (data) => {\n                $basketContent.html(data.content_html);\n                for (let level in data.messages) {\n                    for (let i=0; i<data.messages[level].length; i++) {\n                        _utils.renderMessages(level, data.messages[level][i]);\n                    }\n                }\n                setQuantity();\n                bindCoupon();\n                disallowToChange = false;\n            },\n            error: (data) => {\n                void 0;\n                disallowToChange = true;\n            },\n            always: () => {\n                $basketContent.find('#procced-basket').removeClass('disabled');\n            }\n        });\n    };\n\n\n    $basketContent.on('click', '.remove-item', function (e) {\n        e.preventDefault();\n\n        var formID = $(this).data('id');\n        var inputID = '#id_form-' + formID + '-DELETE';\n        $(inputID).attr('checked', 'checked');\n\n        updateBasket($(this).closest('form'));\n    });\n\n    ////////////////////////////////////////////////\n    /// quantity input\n    ////////////////////////////////////////////////\n    let updateFormDebounce = _utils.debounce(updateBasket, 400);;\n    function setQuantity() {\n        $('.quantity').each(function (ind, elem) {\n            let $quantityWrapper = $(this);\n            let $quantityfield = $quantityWrapper.find('input');\n            let $incr = $quantityWrapper.find('.quantity-incr');\n            let $decr = $quantityWrapper.find('.quantity-decr');\n            let max = +$quantityfield.attr('max') ? +$quantityfield.attr('max') : 10000;\n            let min = +$quantityfield.attr('min');\n            let currentVal = +$quantityfield.val();\n            let getValueInRange = (val) => {\n                if(val > max) {\n                    return parseFloat(max);\n                } else if(val < min) {\n                    return parseFloat(min);\n                } else {\n                    return val;\n                }\n            };\n\n            $quantityfield.on('keypress input cut paste', function () {\n                let number = $(this).val();\n\n                if(number !== 0 && !number) {\n                    disallowToUpdate = true;\n                    $basketContent.find('#procced-basket').addClass('disabled');\n                    return;\n                } else {\n                    disallowToUpdate = false;\n                    $basketContent.find('#procced-basket').removeClass('disabled');\n                }\n\n                if(number > max) {\n                    number = `${max}`;\n                }\n                if(number < min) {\n                    number = `${min}`;\n                }\n                let value = (number.split('.'));\n                if (value[1]){\n                    number = parseFloat(number[0]).toFixed(0);\n                }\n                currentVal = +number;\n                $(this).val( number );\n\n               updateFormDebounce();\n            });\n\n            $incr.on('click', function (e) {\n                e.preventDefault();\n                if(disallowToChange) { return; }\n                if(currentVal >= max) { return; }\n                $quantityfield.val(currentVal + 1);\n                currentVal = currentVal + 1;\n                updateFormDebounce();\n            });\n            $decr.on('click', function (e) {\n                e.preventDefault();\n                if(disallowToChange) { return; }\n                if(currentVal == min) { return; }\n                $quantityfield.val(currentVal - 1);\n                currentVal = currentVal - 1;\n                updateFormDebounce();\n\n            });\n        });\n    }\n\n    setQuantity();\n\n\n\n    ////////////////////////////////////////////////\n    /// coupon\n    ////////////////////////////////////////////////\n\n    const requiredError = window._radonOptions.requiredError;\n    const invalidEmailError = window._radonOptions.invalidEmailError;\n\n\n    function bindCoupon() {\n        let $form = $('#voucher_form');\n        let $confirmBtn = $form.find('button');\n        let formValid = false;\n        $('#voucher_form_link').click(function (e) {\n            e.preventDefault();\n            $(this).hide();\n            $('#voucher_form_container').show();\n        });\n\n        $('#voucher_form_cancel').click(function (e) {\n            e.preventDefault();\n            $('#voucher_form_container').hide();\n            $('#voucher_form_link').show();\n        });\n\n        $form[0].onsubmit = function (e) {\n            if(formValid) {\n                return true;\n            } else {\n                e.preventDefault();\n                var disabled = $confirmBtn.prop('disabled');\n                if (!disabled) {\n                    $confirmBtn.blur();\n                    if (_utils.validateForm($form, requiredError, invalidEmailError)) {\n                        formValid = true;\n                        $form.submit();\n                        $confirmBtn.prop('disabled', true);\n                    }\n                }\n                return false;\n            }\n        };\n    }\n\n    bindCoupon();\n\n\n})(jQuery);\n"]}